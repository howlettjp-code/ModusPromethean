# ====================================================================
# APACHE CONFIG FOR MODUSPROMETHEAN.COM (PRODUCTION)
# Handles HTTP->HTTPS and WWW->Naked redirects.
# Corrected paths to include TLD in directory name.
# ====================================================================

# --------------------------------------------------------------------
# BLOCK 1: Port 80 (HTTP) Usher
# Redirects all unencrypted traffic to the secure naked domain.
# --------------------------------------------------------------------
<VirtualHost *:80>
    ServerName moduspromethean.com
    ServerAlias www.moduspromethean.com

    Redirect permanent / https://moduspromethean.com/
</VirtualHost>


# --------------------------------------------------------------------
# BLOCK 2: Port 443 (HTTPS) Main Site
# Serves the actual website on the naked domain.
# --------------------------------------------------------------------
<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName moduspromethean.com
    # No ServerAlias here; www is handled in Block 3.

    # UPDATED PATH: Includes the .com TLD
    DocumentRoot /var/www/moduspromethean.com/public
    ServerAdmin webmaster@localhost

    # UPDATED PATH: Includes the .com TLD
    <Directory /var/www/moduspromethean.com/public/>
        Options FollowSymLinks Indexes
        AllowOverride All
        Require all granted
    </Directory>

    # ---------------- SSL Configuration ----------------
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/moduspromethean.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/moduspromethean.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
    # ---------------------------------------------------

    # Separate logs for production
    ErrorLog ${APACHE_LOG_DIR}/mp-prod-error.log
    CustomLog ${APACHE_LOG_DIR}/mp-prod-access.log combined
</VirtualHost>

# --------------------------------------------------------------------
# BLOCK 3: Port 443 (HTTPS) WWW Usher
# Redirects secure www traffic to the secure naked domain.
# --------------------------------------------------------------------
<VirtualHost *:443>
    ServerName www.moduspromethean.com

    # ---------------- SSL Configuration ----------------
    SSLEngine on
    # Must use the same certificate paths as Block 2
    SSLCertificateFile /etc/letsencrypt/live/moduspromethean.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/moduspromethean.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
    # ---------------------------------------------------

    Redirect permanent / https://moduspromethean.com/
</VirtualHost>
</IfModule>